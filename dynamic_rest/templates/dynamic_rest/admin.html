{% load staticfiles %}
{% load i18n %}
{% load rest_framework %}
{% load dynamic_rest %}

<!DOCTYPE html>
<html lang="en">
    {% block head %}
        <head>
            {% block meta %}
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
                <meta name="robots" content="NONE,NOARCHIVE" />
                <meta name="viewport" content="width=device-width, initial-scale=1">
            {% endblock %}
            {% block title %}
                <title>
                    {{ title }}
                </title>
            {% endblock %}
            {% block css %}
                {% block bootstrap_css %}
                    <link
                    rel="stylesheet"
                    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
                    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
                    crossorigin="anonymous">
                {% endblock %}
                {% block css__fontawesome %}
                    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
                {% endblock %}
                {% block css__select2 %}
                    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css"/>
                {% endblock %}
                {% block css__datatables %}
                    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.16/cr-1.4.1/fh-3.1.3/r-2.2.1/sc-1.4.4/datatables.min.css"/>
                {% endblock %}
                {% block css__dropify %}
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/css/dropify.min.css" media="all" rel="stylesheet" type="text/css" />
                {% endblock %}
                {% block css__material %}
                    <link href="https://fonts.googleapis.com/icon?family=Roboto|Material+Icons" rel="stylesheet">
                    <link rel="stylesheet" href="//cdn.materialdesignicons.com/2.3.54/css/materialdesignicons.min.css">
                    <link href="{% static "dynamic_rest/css/material.css" %}" rel="stylesheet" type="text/css"/>
                {% endblock %}
                {% block css__drest %}
                    <link rel="stylesheet" type="text/css" href="{% static "dynamic_rest/css/custom.css" %}?version={% drest_version %}"/>
                {% endblock %}
                {% block css__datetimepicker %}
                    <link rel="stylesheet" type="text/css" href="{% static "dynamic_rest/css/bootstrap-material-datetimepicker.css" %}"></link>
                {% endblock %}
            {% endblock %}
            {% block script %}
                {% block script__jquery %}
                    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
                {% endblock %}
                {% block script__numeral %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
                {% endblock %}
                {% block script__drest %}
                    <script src="{% static "dynamic_rest/js/drest-form.js" %}?version={% drest_version %}"></script>
                {% endblock %}
                {% block script__tether %}
                    <script
                        src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
                        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous">
                    </script>
                {% endblock %}
                {% block script__masonry %}
                    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
                {% endblock %}
                {% block script__bootstrap %}
                    <script
                        src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
                        integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
                {% endblock %}
                {% block script__select2 %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.full.min.js"></script>
                {% endblock %}
                {% block script__datatables %}
                    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.16/cr-1.4.1/fh-3.1.3/r-2.2.1/sc-1.4.4/datatables.min.js"></script>
                {% endblock %}
                {% block script__renderjson %}
                    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/renderjson@1.3.1/renderjson.min.js"></script>
                {% endblock %}
                {% block script__popper %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
                {% endblock %}
                {% block script__moment %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
                {% endblock %}
                {% block script__tippy %}
                    <script src="https://unpkg.com/tippy.js@2.5.2/dist/tippy.all.min.js"></script>
                {% endblock %}
                {% block script__dropify %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/js/dropify.min.js" type="text/javascript"></script>
                {% endblock %}
                {% block script__material %}
                    <script src="https://unpkg.com/material-components-web@0.36.1/dist/material-components-web.min.js"></script>
                {% endblock %}
                {% block script__datetimepicker %}
                    <script src="{% static "dynamic_rest/js/bootstrap-material-datetimepicker.min.js" %}"></script>
                {% endblock %}
                {% block script__autosize %}
                    <script src="https://cdn.jsdelivr.net/npm/autosize@4.0.2/dist/autosize.min.js"></script>
                {% endblock %}
                {% block script__cleave %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.4.2/cleave.min.js"></script>
                {% endblock %}
                {% block script__apexcharts %}
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/2.2.4/apexcharts.js"></script>
                {% endblock %}
            {% endblock %}
       </head>
    {% endblock %} <!-- /head -->
    {% block body %}
        <body>
            {% block header %}
                <header
                    id="drest-header"
                    class="drest-app mdc-theme--on-primary mdc-top-app-bar mdc-top-app-bar--fixed"
                    data-mdc-auto-init="MDCTopAppBar"
                >
                    <div class="mdc-top-app-bar__row">
                        <section class="mdc-top-app-bar__section mdc-top-app-bar__section-align-start">
                             {% block header_nav %}
                                {% if show_nav %}
                                    <span class="drest-app__back-button material-icons mdc-top-app-bar__navigation-icon">arrow_back</span>
                                    <span class="drest-app__navigation drest-app__nav-button mdc-top-app-bar__navigation-icon" id="drest-header-nav">{{ nav_icon }}</span>
                                {% endif %}
                                {% if style == 'directory' %}
                                        <span class="drest-app__navigation material-icons mdc-top-app-bar__action-item">mood</span>
                                {% endif %}
                                {% if style == 'error' %}
                                        <span class="drest-app__navigation material-icons mdc-top-app-bar__action-item">error</span>
                                {% endif %}
                            {% endblock %}
                            {% if allow_search %}
                                <span class="drest-app__search-container">
                                    <input class="drest-app__search-input" type="text" placeholder="Search {{ plural_name }}"/>
                                </span>
                            {% endif %}
                            <span class="mdc-top-app-bar__title drest-app__title">
                                {% block header_content %}
                                    <span class="drest-app__title-content">{{ header }}</span>
                                {% endblock %}
                            </span>
                        </section>
                        <section class="drest-app__toolbar mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                            {% if allow_search %}
                                <span class="drest-app__search-button material-icons mdc-top-app-bar__action-item" aria-label="Search" alt="Search">search</span>
                            {% endif %}
                            <span class="drest-app__clear-button material-icons mdc-top-app-bar__navigation-icon">close</span>
                            {% if show_menu %}
                                <span class="drest-app__more-button mdc-top-app-bar__action-item">
                                    <span class="material-icons" aria-label="More" alt="More options">more_vert</span>
                                    <span class="mdc-menu-anchor" style="">
                                        <div class="mdc-menu drest-app__more-menu">
                                            <ul class="mdc-menu__items mdc-list">
                                                {% if allow_delete %}
                                                    <li role="menuitem" tabindex="0" class="drest-app__delete-button mdc-list-item">
                                                        <span class="material-icons mr-2">delete</span>
                                                        Delete
                                                    </li>
                                                {% endif %}
                                                {% for action in actions %}
                                                    <li data-goto="{{ action.url }}" tabindex="0" role="menuitem" class="drest-goto mdc-list-item">
                                                        {% if action.icon %}
                                                            <span class="material-icons mr-2">{{ action.icon }}</span>
                                                        {% endif %}
                                                        {{ action.label }}
                                                    </li>
                                                {% endfor %}
                                                {% if allow_filter %}
                                                    <li data-target="#drest-filter-form" tabindex="0" role="menuitem" class="drest-app__filter-button drest-app__switch-to mdc-list-item">
                                                        <span class="mdi mdi-filter material-icons mr-2"></span>
                                                        Find
                                                    </li>
                                                {% endif %}
                                                {% if request.user.is_authenticated %}
                                                    <li tabindex="0" role="menuitem" class="drest-logout mdc-list-item">
                                                        <span class="material-icons mr-2">lock_open</span>
                                                        Logout
                                                    </li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </span>
                                </span>
                            {% endif %}
                            <span class="drest-app__save-button mdc-top-app-bar__action-item">
                                <span class="material-icons" aria-label="Save" alt="save">check</span>
                            </span>
                            <span class="drest-app__spinner mdc-top-app-bar__action-item">
                                <svg class="drest-spinner" width="23px" height="23px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                   <circle class="drest-spinner__path" fill="none" stroke-width="3" stroke-linecap="round" cx="12" cy="12" r="10"></circle>
                                </svg>
                            </span>
                        </section>
                    </div>
                </header>
            {% endblock %} <!-- /header -->
            {% block drawer %}
                <aside id="drest-drawer" class="mdc-drawer mdc-drawer--temporary mdc-typography">
                    <nav class="mdc-drawer__drawer">
                        <div class="drest-drawer__header">
                            <div class="mdc-list">
                                <div class="mdc-list-item">
                                    <div class="drest-icon-left material-icons">close</div>
                                    {{ header }}
                                </div>
                            </div>
                        </div>
                        <nav class="mdc-drawer__content drest-drawer__content">
                            {% block drawer_content %}
                                {% include "dynamic_rest/admin/directory.html" %}
                            {% endblock %}
                        </nav>
                    </nav>
                </aside>
            {% endblock %}
            {% block content %}
                <div id="drest-content-container" style="display: none">
                    <div class="drest-content">
                        <div class="drest-navigation">
                                {% if style == 'list' %}
                                    <div class="drest-scene">
                                        {% include "dynamic_rest/admin/list.html" %}
                                    </div>
                                {% endif %}
                                {% if style == 'directory' %}
                                    <div class="drest-scene">
                                        {% include "dynamic_rest/admin/directory.html" %}
                                    </div>
                                {% endif %}
                                {% if style == 'detail' %}
                                    <div class="drest-scene">
                                        {% include "dynamic_rest/admin/detail.html" %}
                                    </div>
                                {% endif %}
                                {% if style == 'error' %}
                                    <div class="drest-scene">
                                        {% include "dynamic_rest/admin/error.html" %}
                                    </div>
                                {% endif %}
                                {% if allow_add %}
                                    <div class="drest-scene">
                                        <form
                                            id="drest-add-form"
                                            action="{{ request.get_full_path }}"
                                            method="POST"
                                            class="drest-form drest-form--add">
                                            {% csrf_token %}
                                            {{ post_form }}
                                        </form>
                                        <script>
                                            new DRESTForm({
                                                container: '#drest-add-form',
                                                type: 'add',
                                                resourceName: '{{ singular_name }}'
                                            });
                                        </script>
                                    </div>
                                {% endif %}
                                {% if allow_filter %}
                                    <div class="drest-scene">
                                        <form
                                            id="drest-filter-form"
                                            class="drest-form drest-form--filter"
                                            method="GET"
                                            action="{{ list_url }}">
                                            <div class="drest-grid drest-grid--1x">
                                                <div class="drest-grid__item">
                                                    <div class="mdc-card drest-section">
                                                        <div class="mdc-card__title">
                                                            Filters
                                                        </div>
                                                        <div class="mdc-card__fields">
                                                            {% for filter in filters.values %}
                                                                {% render_filter filter %}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <input class="drest-hidden" type="submit"/>
                                        </form>
                                        <script>
                                            new DRESTForm({
                                                container: '#drest-filter-form',
                                                type: 'filter',
                                                resourceName: '{{ plural_name }}'
                                            });
                                        </script>
                                    </div>
                                {% endif %}
                                {% for related_name, serializer_and_form in create_related_forms.items %}
                                    <div class="drest-scene">
                                        <div class="drest-form__header">
                                            <label>{{ singular_name }}:</label>
                                            <span>{{ name }}</span>
                                        </div>
                                        <form
                                            id="drest-add-form-{{ related_name }}"
                                            action="{{ serializer | get_related_url:related_name }}/"
                                            method="POST"
                                            class="drest-form drest-form--add-related">
                                                {{ serializer_and_form.1 }}
                                        </form>
                                        <script>
                                            new DRESTForm({
                                                container: '#drest-add-form-{{ related_name }}',
                                                resourceName: '{{ serializer_and_form.0.get_name | humanize }}',
                                                type: 'add-related'
                                            });
                                        </script>
                                    </div>
                                {% endfor %}
                        </div>
                    </div>
                </div>
            {% endblock %} <!-- /content -->

            {% block footer %}
                {% if style == 'detail' %}
                    {% if allow_edit %}
                        <div id="drest-fab" class="drest-fab--edit mdc-theme--primary-bg mdc-fab mdc-fab--fixed-br">
                            <span class="mdc-fab__icon material-icons">edit</span>
                        </div>
                    {% endif %}
                {% endif %}
                {% if style == 'list' %}
                    {% if allow_add %}
                        <div data-target="#drest-add-form" id="drest-fab" class="drest-app__switch-to drest-fab--add mdc-theme--primary-bg mdc-fab mdc-fab--fixed-br">
                            <span class="mdc-fab__icon material-icons">add</span>
                        </div>
                    {% endif %}

                {% endif %}
                {% if paginator %}
                    <div class="drest-pagination-container">
                        <div class="drest-pagination">
                            {% get_pagination_html paginator %}
                        </div>
                    </div>
                {% endif %}
            {% endblock %} <!-- /footer -->
            {% block dialog %}
                <aside id="drest-dialog"
                    class="mdc-dialog"
                    role="alertdialog"
                    aria-labelledby="drest-dialog-label"
                    aria-describedby="drest-dialog-description">
                    <div class="mdc-dialog__surface">
                        <header class="mdc-dialog__header">
                            <h2 id="drest-dialog-label" class="mdc-dialog__header__title drest-dialog__title"></h2>
                        </header>
                        <section id="drest-dialog-description" class="mdc-dialog__body drest-dialog__body"></section>
                        <footer class="mdc-dialog__footer">
                            <button type="button" class="mdc-button mdc-dialog__footer__button drest-dialog__cancel"></button>
                            <button type="button" class="mdc-button mdc-dialog__footer__button drest-dialog__accept"></button>
                        </footer>
                    </div>
                    <div class="mdc-dialog__backdrop"></div>
                </aside>
            {% endblock %}
            {% block notice %}
                <div
                    id="drest-notice"
                    class="mdc-snackbar mdc-snackbar--align-start"
                    aria-live="assertive"
                    aria-atomic="true"
                    aria-hidden="true">
                    <div class="mdc-snackbar__text drest-notice__body"></div>
                    <div class="mdc-snackbar__action-wrapper">
                        <button type="button" class="drest-notice__action mdc-snackbar__action-button"></button>
                    </div>
                </div>
            {% endblock %}
        </body>
    {% endblock %} <!-- /body -->
    {% block initializer %}
         <script>
            window.drf = {
                csrfHeaderName: "{{ csrf_header_name|default:'X-CSRFToken' }}",
                csrfCookieName: "{{ csrf_cookie_name|default:'csrftoken' }}"
            };

            mdc.autoInit();
            if ('{{ style }}') {
                window.app = new drest.DRESTApp({
                    resourceName: '{{ singular_name }}',
                    resourceNamePlural: '{{ plural_name }}',
                    drawer: '#drest-drawer',
                    header: '#drest-header',
                    table: '#drest-table',
                    fab: '#drest-fab',
                    style: '{{ style }}',
                    content: '#drest-content-container',
                    dialog: '#drest-dialog',
                    notice: '#drest-notice',
                    listURL: '{{ list_url }}',
                    detailURL: {{ detail_url | to_json }},
                    logoutURL: {{ logout_url | to_json }},
                    nameField: {{ name_field | to_json }},
                    searchKey: '{{ search_key }}',
                    url: '{{ url }}',
                    userName: {{ user_name | to_json }}
                });
            }

            $(function() {
                // drest-json
                $('.drest-json').each(function(index){
                    var json = $(this).data('json');
                    if (json) {
                        $(this)[0].appendChild(renderjson(json));
                    }
                });
                // drest-goto
            });
        </script>
    {% endblock %} <!-- /script -->
</html>
